name: Create Repositories

on:
  workflow_dispatch:

jobs:
  scheduled:
    runs-on: ubuntu-latest
    steps:
    - name: Check out this repo
      uses: actions/checkout@v2
    - name: Create repositories
      run: |-        
        while IFS='' read -r LINE || [ -n "${LINE}" ]; do
          echo "Scraping ${LINE}"
          REPO="git@github.com:sharms/reddit-${LINE}-data.git"
          if git ls-remote "${REPO}"; then
            echo "${REPO} already exists"
          else
            echo "Creating ${REPO}"
            curl -H "Authorization: token ${{ secrets.ACCESS_TOKEN }}" --data "{\"name\":\"reddit-${LINE}-data\",\"visibility\":\"private\"}" https://api.github.com/user/repos
          fi
        done < ./subreddits
